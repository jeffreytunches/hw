/**
 * Mediaslide Book
 * (c) Emmanuel MATHIEU
 * emmanuel@mediaslide.com
 * All right reserved.
 */

(function(e){e.Book=function(t){e(document).unbind("keydown");this.element=t.element,this.nbMax=t.nbMax;this.bookType=t.bookType;this.currentPage=1;this.bookWidth=t.bookWidth;this.bookHeight=t.bookHeight};e.Book.prototype={InitEvents:function(){var t=this;e(document).keydown(function(e){if(e.keyCode==37){t.previousPage();return false}else if(e.keyCode==39){t.nextPage();return false}});this.loadImagesHD(this.currentPage+1);this.loadImagesHD(this.currentPage+2);this.element.append('<div id="bookLeftArrow" style="display: none" onclick="previousPage()"></div>');this.element.append('<div id="bookRightArrow" onclick="nextPage()"></div>');e("#bookLeftArrow").css("top",(this.bookHeight-87)/2);e("#bookRightArrow").css("top",(this.bookHeight-87)/2);e("#modelInfos").css("margin-top",(this.bookHeight-e("#modelInfos").height())/2);this.resizeImages(0,1)},resizeImages:function(t,n){var r=this.bookWidth;var i=Math.ceil(r/2);var s=r/2;var o=i;var u=this.bookHeight;e("#modelBook").css("width",r);e("#modelBook").css("height",this.bookHeight);e(".leftPage").css("left","0px");e(".leftPage").css("text-align","right");e(".rightPage").css("left",i+10+"px");e(".rightPageNoSpace").css("left",i+"px");if(this.bookType!="video"){e(".bookPage").css("height",this.bookHeight);e(".bookPage").css("width",i)}else{e("#video").css("width",r);e("#video").css("height",this.bookHeight)}if(e("#image_"+t).parent().hasClass("double")){var a=0;var f=e("#image_"+t).attr("width");var l=e("#image_"+t).attr("height");if(l<u){a=u/l;l=u;f=Math.ceil(f*a);e("#image_"+t).css("height",l);e("#image_"+t).css("width",f);e("#image_"+n).css("height",l);e("#image_"+n).css("width",f)}if(l>u){a=u/l;e("#image_"+t).css("width",f*a);e("#image_"+t).css("height",Math.ceil(l*a));l=Math.ceil(l*a);f=f*a}if(f>i*2){a=i*2/f;e("#image_"+t).css("width",f*a);e("#image_"+t).css("height",Math.ceil(l*a));l=Math.ceil(l*a);f=f*a}e("#image_"+n).css("width",f);e("#image_"+n).css("height",Math.ceil(l));e("#image_"+t).css("margin-right",-1*f/2);e("#image_"+n).css("margin-left",-1*f/2);e("#image_"+t).parent().css("height",Math.ceil(l));e("#image_"+n).parent().css("height",Math.ceil(l));var c=(this.bookHeight-l)/2;if(c>=0){e("#image_"+t).parent().css("margin-top",c);e("#image_"+n).parent().css("margin-top",c)}}else{if(t!=0){var a=0;var f=e("#image_"+t).attr("width");var l=e("#image_"+t).attr("height");if(l>f&&l<u){a=u/l;l=u;e("#image_"+t).css("height",l);e("#image_"+t).css("width",Math.ceil(f*a))}if(f>o){a=o/f;e("#image_"+t).css("width",o);e("#image_"+t).css("height",Math.ceil(l*a));l=Math.ceil(l*a);f=Math.ceil(f*a)}if(l>u){a=u/l;l=u;e("#image_"+t).css("height",u);e("#image_"+t).css("width",Math.ceil(f*a));f=Math.ceil(f*a)}else{var c=(this.bookHeight-l)/2;if(c>=0)e("#image_"+t).parent().css("margin-top",c)}e("#image_"+t).parent().css("height",l)}if(n<=this.nbMax){var h=0;var p=e("#image_"+n).attr("width");var d=e("#image_"+n).attr("height");if(d>p&&d<u){a=u/d;d=u;e("#image_"+n).css("height",d);e("#image_"+n).css("width",Math.ceil(p*a))}if(p>o){h=o/p;e("#image_"+n).css("width",o);e("#image_"+n).css("height",Math.ceil(d*h));d=Math.ceil(d*h);p=Math.ceil(p*h)}if(d>u){a=u/d;d=u;e("#image_"+n).css("height",u);e("#image_"+n).css("width",Math.ceil(p*a));p=Math.ceil(p*a)}else{var c=(this.bookHeight-d)/2;if(c>=0)e("#image_"+n).parent().css("margin-top",c)}e("#image_"+n).parent().css("height",d)}}},preload_picture:function(e,t){var n=new Image;n.onload=function(){if(t){t()}};n.src=e},loadImagesHD:function(t){if(e("#image_"+t)[0]!==undefined){if(!e("#image_"+t).hasClass("complete")){e("#image_"+t).addClass("complete");this.preload_picture([e("#image_"+t).attr("full-size")],function(){e("#image_"+t).attr("src",e("#image_"+t).attr("full-size"))})}}},nextPage:function(){e("#bookLeftArrow").show();if(this.currentPage>=this.nbMax-2){e("#bookRightArrow").hide()}else e("#bookRightArrow").show();if(this.currentPage>=this.nbMax)return false;e(".bookPage").hide();e("#page_"+(this.currentPage+1)).fadeIn();e("#page_"+(this.currentPage+2)).fadeIn();this.resizeImages(this.currentPage+1,this.currentPage+2);this.currentPage+=2;this.loadImagesHD(this.currentPage+1);this.loadImagesHD(this.currentPage+2)},previousPage:function(){e("#bookRightArrow").show();if(this.currentPage<=3)e("#bookLeftArrow").hide();else e("#bookLeftArrow").show();if(this.currentPage<=1)return false;e(".bookPage").hide();e("#page_"+(this.currentPage-2)).fadeIn();e("#page_"+(this.currentPage-3)).fadeIn();this.resizeImages(this.currentPage-2,this.currentPage-3);this.currentPage-=2}}})(jQuery)